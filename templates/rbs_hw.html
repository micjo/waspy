{% extends "base.html" %}
{% import "ui_elements.html" as ui_elements %}
{% block title %}RBS Hardware{% endblock %}

{% block content %}
<script type="module">
    import * as max_aml from '{{url_for('static', filename='max_aml.js')}}'
    import * as max_motrona from '{{url_for('static', filename='max_motrona.js')}}'
    window.max_aml = max_aml;
    window.max_motrona = max_motrona;
    max_aml.setMinMode();
    max_motrona.setMinMode();
</script>


{% for aml in aml_config %}
{% set prefix = aml["id"] %}
{% set dTitle = aml["title"] %}
{% set first_name = aml["first_name"] %}
{% set second_name = aml["second_name"] %}
{% set first_load = aml["first_load"] %}
{% set second_load = aml["second_load"] %}
{% set url = '/api/' + aml["id"] %}
<hr>
<div class="left-to-right"><h5> {{dTitle}}  </h5>
    <h5><span class="badge badge-danger" id="{{prefix}}_connect_status">Not Running</span></h5>
</div>
<hr>

{{ ui_elements.dataLabelWithBadge('Request Acknowledge:', prefix +'_request_id') }}
{{ ui_elements.dataLabelWithBadge('Request Finished:', prefix+'_request_finished') }}
{{ ui_elements.dataLabelWithBadge('Error:', prefix+'_error') }}
{{ ui_elements.redefineButtonCall(first_name+':', 'max_aml.sendFloat', url, prefix, 'first', 'set_m1_target_position', 'move')}}
{{ ui_elements.redefineButtonCall(second_name+':', 'max_aml.sendFloat', url, prefix, 'second', 'set_m2_target_position', 'move')}}

<div class="push-right">
{{ ui_elements.buttonSpinnerWithCall("Move Both", "max_aml.submit", url, prefix, 'submit') }}
{{ ui_elements.buttonWithCall("Load", ui_elements.func3("max_aml.load", prefix, first_load, second_load ))}}
{{ ui_elements.buttonSpinnerWithRequest("hide", "max_aml.sendARequest", url, prefix, 'hide', '{"hide":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("show", "max_aml.sendARequest", url, prefix, 'show', '{"hide":false}') }}
{{ ui_elements.buttonSpinnerWithRequest("continue", "max_aml.sendARequest", url, prefix, 'continue', '{"continue":true}') }}
</div>

{% endfor %}

{% for motrona in motrona_config %}
{% set prefix = motrona["id"] %}
{% set dTitle = motrona["title"] %}
{% set url = '/api/' + motrona["id"] %}
<hr>
<div class="left-to-right"><h5> {{dTitle}}  </h5>
    <h5><span class="badge badge-danger" id="{{prefix}}_connect_status">Not Running</span></h5>
</div>
<hr>
{{ ui_elements.dataLabelWithBadge('Request Id:', prefix+'_request_id') }}
{{ ui_elements.dataLabelWithBadge('Request Finish:', prefix+'_request_finished') }}
{{ ui_elements.dataLabelWithBadge('Counts:', prefix+'_counts') }}
{{ ui_elements.dataLabelWithBadge('Counting Status:', prefix+'_status') }}
{{ ui_elements.dataLabelWithBadge('charge(nC):', prefix+'_charge') }}
{{ ui_elements.dataLabelWithBadge('Counting time(msec):', prefix+'_counting_time') }}
{{ ui_elements.dataLabelWithBadge('Current(nA):', prefix+'_current') }}
{{ ui_elements.dataLabelWithBadge('Error Status:', prefix+'_error') }}
{{ ui_elements.redefineButtonCall('Target Charge:', 'max_motrona.sendFloat', url, prefix, 'target_charge', 'target_charge','Set')}}
<div class="push-right">
{{ ui_elements.buttonSpinnerWithRequest("pause counting", "max_motrona.sendARequest", url, prefix, 'pause', '{"pause_counting":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("clear start counting", "max_motrona.sendARequest", url, prefix, 'clearstart', '{"clear-start_counting":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("hide", "max_motrona.sendARequest", url, prefix, 'hide', '{"hide":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("show", "max_motrona.sendARequest", url, prefix, 'show', '{"hide":false}') }}
{{ ui_elements.buttonSpinnerWithRequest("continue", "max_motrona.sendARequest", url, prefix, 'continue', '{"continue":true}') }}
</div>
{% endfor %}

<script type="module">
    max_aml.setMinMode();
    max_motrona.setMinMode();
{% for aml in aml_config %}
    max_aml.refreshAllData('/api/{{aml["id"]}}', '{{aml["id"]}}');
{% endfor %}
{% for motrona in motrona_config %}
    max_motrona.refreshAllData('/api/{{motrona["id"]}}', '{{motrona["id"]}}');
{% endfor %}
    window.setInterval(function() {
        {% for aml in aml_config %}
            max_aml.refreshAllData('/api/{{aml["id"]}}', '{{aml["id"]}}');
        {% endfor %}
        {% for motrona in motrona_config %}
            max_motrona.refreshAllData('/api/{{motrona["id"]}}', '{{motrona["id"]}}');
        {% endfor %}

    }, 2000);
</script>

{% endblock %}
