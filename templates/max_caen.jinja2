{% extends "base.jinja2" %}
{% import "ui_elements.jinja2" as ui_elements %}

{%set url = '/api/' + prefix %}
{%set winTitle =  config["title"] %}

{% block content %}

<hr>
<div class="clearfix">
    <h3 class="float-start">{{winTitle}}</h3>
    <h5 class="clearfix float-end">
        <span class="badge bg-info" id="{{prefix}}_brief_status">-</span>
        <span class="badge badge-danger" id="{{prefix}}_sanity_status">Not Running</span>
    </h5>
</div>
<hr>

<table class="table table-striped table-hover table-sm">
    <thead>  {{ ui_elements.tableHeader() }} </thead>
    <tbody>
        {{ ui_elements.value_row('Request Acknowledge:', prefix+'_request_id') }}
        {{ ui_elements.value_row('Request Finished:', prefix+'_request_finished') }}
        {{ ui_elements.value_row('Error:', prefix+'_error') }}
        {{ ui_elements.value_row('Acquiring:', prefix+'_acquiring') }}
    </tbody>
</table>

<div class="clearfix"><div class="btn-group float-end">
{{ ui_elements.buttonSpinnerWithRequest("connect and configure", "max_caen.sendARequest", url, prefix, 'start_all', '{"open_connection":true, "write_registry":true, "acquire_data":true, "start_acquisition": true}') }}
{{ ui_elements.buttonSpinnerWithRequest("start acquisition", "max_caen.sendARequest", url, prefix, 'acquire_start', '{"start_acquisition":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("stop acquisition", "max_caen.sendARequest", url, prefix, 'acquire_stop', '{"stop_acquisition":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("store registers", "max_caen.sendARequest", url, prefix, 'store_reg', '{"store_registers":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("open connection", "max_caen.sendARequest", url, prefix, 'open', '{"open_connection":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("reset", "max_caen.sendARequest", url, prefix, 'reset', '{"reset":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("clear", "max_caen.sendARequest", url, prefix, 'clear', '{"clear":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("continue", "max_caen.sendARequest", url, prefix, 'continue', '{"continue":true}') }}
    </div></div>
<hr>
<h5>Plotting</h5>

<div class="input-group input-sm mb-3">
  <label class="input-group-text" for="board_select">Board:</label>
  <select class="form-select" id="board_select">
    <option selected>Choose...</option>
    <option value="1">Board-1</option>
    <option value="2">Board-2</option>
    <option value="3">Board-3</option>
    <option value="4">Board-4</option>
    <option value="5">Board-5</option>
    <option value="6">Board-6</option>
    <option value="7">Board-7</option>
    <option value="8">Board-8</option>
  </select>
  <label class="input-group-text" for="channel_select">Channel:</label>
  <select class="form-select" id="channel_select">
    <option selected>Choose...</option>
    <option value="0">Channel-0</option>
    <option value="1">Channel-1</option>
    <option value="2">Channel-2</option>
    <option value="3">Channel-3</option>
    <option value="4">Channel-4</option>
    <option value="5">Channel-5</option>
    <option value="6">Channel-6</option>
    <option value="7">Channel-7</option>
    <option value="8">Channel-8</option>
    <option value="9">Channel-9</option>
    <option value="10">Channel-10</option>
    <option value="11">Channel-11</option>
    <option value="12">Channel-12</option>
    <option value="13">Channel-13</option>
    <option value="14">Channel-14</option>
    <option value="15">Channel-15</option>
  </select>
  <label class="input-group-text" for="channel_select">Update:</label>
  <div class="input-group-text">
      <input class="form-check-input mt-0" id="update_graph_request" type="checkbox" value="" aria-label="Checkbox for following text input">
  </div>
</div>
      <div id="histo_chart">
      </div>
  </div>

<script type="module">
    import * as max_caen from '{{url_for('static', path='max_caen.js')}}'
    window.max_caen = max_caen;
    max_caen.refreshData('{{url}}','{{prefix}}');
    window.setInterval(function() {
        max_caen.refreshData('{{url}}','{{prefix}}');
        max_caen.drawGraph('{{url}}','{{prefix}}');
    }, 2000);
</script>
{% endblock %}
