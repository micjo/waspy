{% extends "base.html" %}
{% block title %}Welcome{% endblock %}
{% block content %}

<h3>CAEN Board 0 - Channel 0</h3> 
<div class="container">
  
  <canvas id="chart" width="800" height="600"></canvas>
</div> 
<div class="container"><label> update</label><input type="checkbox" id="update_chart"> </div>

<script>
  window.setInterval(function(){
    refreshData();
},1000)

var lineChart
Chart.defaults.global.animationSteps = 0;

Chart.defaults.global.tooltipYPadding = 16;
Chart.defaults.global.tooltipCornerRadius = 0;
Chart.defaults.global.tooltipTitleFontStyle = "normal";
Chart.defaults.global.tooltipFillColor = "rgba(0,0,0,0.8)";
Chart.defaults.global.animationEasing = "easeOutBounce";
Chart.defaults.global.responsive = false;
Chart.defaults.global.scaleLineColor = "black";
Chart.defaults.global.scaleFontSize = 16;


let x_coordinates = [];
let y_coordinates = [];
var ctx = document.getElementById('chart').getContext('2d');
lineChart = new Chart(ctx, {
  // The type of chart we want to create
  type: 'line',

  // The data for our dataset
  data: {
      labels: [],
      datasets: [{
          label: 'Histogram Board 0 CHannel 0',
          data: [],
          backgroundColor: 'rgba(242, 207, 222, 0.40)'
      }]
  },

  // Configuration options go here
  options: {
    animation: {
      duration: 0
    }
  }
});

function refreshData() {

  console.log("hello");
  let url = "http://192.168.1.40:22123/liveData";
  let xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4)
    {

      data = JSON.parse(xhr.response)["Board-0"]["Channel-0"]["energy_histogram"];
      dataStrList = data.split(";");
      console.log(dataStrList);
      
      lineChart.data.labels = [];
      lineChart.data.datasets[0].data = [];
      for (const point of dataStrList) {
        if (point) {
          x_and_y = point.split(",");
          lineChart.data.labels.push(parseInt(x_and_y[0]));
          lineChart.data.datasets[0].data.push(parseInt(x_and_y[1]));
        }
      }

    if (lineChart) {
      lineChart.update();


    }


    }
  }

  if (document.getElementById("update_chart").checked) 
  {
    xhr.open("GET", url, true);
    xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8");
    xhr.send();
  }

  
}

</script>




{% endblock %}
