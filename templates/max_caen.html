{% extends "base.html" %}
{% import "ui_elements.html" as ui_elements %}

{%set prefix = config["id"] %}
{%set url = '/api/' + config["id"] %}
{%set winTitle =  config["title"] %}

{% block title %}{{winTitle}}{% endblock %}
{% block content %}

<hr>
<div class="left-to-right d-flex align-items-center"> <b>{{winTitle}}</b>
    <span class="badge badge-danger" id="{{prefix}}_connect_status">Not Running</span>
</div>
<hr>

<table class="table table-striped table-sm">
    <thead>
        <tr>
            <th scope="col">Identifier</th>
            <th scope="col">Value</th>
        </tr>
    </thead>
    <tbody>
        {{ ui_elements.value_row('Request Acknowledge:', prefix+'_request_id') }}
        {{ ui_elements.value_row('Request Finished:', prefix+'_request_finished') }}
        {{ ui_elements.value_row('Error:', prefix+'_error') }}
        {{ ui_elements.value_row('Acquiring:', prefix+'_acquiring') }}
    </tbody>
</table>

</div>
<div class="push-right me-5 ms-5">
{{ ui_elements.buttonSpinnerWithRequest("connect and configure", "max_caen.sendARequest", url, prefix, 'start_all', '{"open_connection":true, "write_registry":true, "acquire_data":true, "start_acquisition": true}') }}
{{ ui_elements.buttonSpinnerWithRequest("start acquisition", "max_caen.sendARequest", url, prefix, 'acquire_start', '{"start_acquisition":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("stop acquisition", "max_caen.sendARequest", url, prefix, 'acquire_stop', '{"stop_acquisition":true}') }}
</div>

<ul class="nav nav-tabs ms-5 me-5" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#histogram" type="button" role="tab" aria-controls="home" aria-selected="true">Histogram</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#adv-control" type="button" role="tab" aria-controls="profile" aria-selected="false">Advanced Controls</button>
  </li>
</ul>
<div class="tab-content ms-5 me-5 mt-5" id="myTabContent">
  <div class="tab-pane fade show active" id="histogram" role="tabpanel" aria-labelledby="home-tab">
<div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" id="graph_update">
  <label class="form-check-label" for="flexSwitchCheckDefault">Update graph</label>
</div>
      <div id="histo_chart">
      </div>
  </div>
  <div class="tab-pane fade" id="adv-control" role="tabpanel" aria-labelledby="profile-tab">
<div class="push-right">
{{ ui_elements.buttonSpinnerWithRequest("store registers", "max_caen.sendARequest", url, prefix, 'store_reg', '{"store_registers":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("open connection", "max_caen.sendARequest", url, prefix, 'open', '{"open_connection":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("reset", "max_caen.sendARequest", url, prefix, 'reset', '{"reset":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("clear", "max_caen.sendARequest", url, prefix, 'clear', '{"clear":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("continue", "max_caen.sendARequest", url, prefix, 'continue', '{"continue":true}') }}
</div>

  </div>
</div>

<script type="module">
    import * as max_caen from '{{url_for('static', filename='max_caen.js')}}'
    window.max_caen = max_caen;
    max_caen.refreshAllData('{{url}}','{{prefix}}');
    max_caen.drawGraph();
    window.setInterval(function() {
        max_caen.refreshAllData('{{url}}','{{prefix}}');
    }, 2000);
</script>
{% endblock %}
