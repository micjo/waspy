{% extends "base.html" %}
{% import "ui_elements.html" as ui_elements %}

{%set prefix = config["id"] %}
{%set url = '/api/' + config["id"] %}
{%set winTitle =  config["title"] %}

{% block title %}{{winTitle}}{% endblock %}
{% block content %}

<hr>
<div class="clearfix">
    <h3 class="float-start">{{winTitle}}</h3>
    <h5 class="float-end">
        <span class="badge badge-danger" id="{{prefix}}_connect_status">Not Running</span>
    </h5>
</div>
<hr>

<table class="table table-striped table-hover table-sm">
    <thead>  {{ ui_elements.tableHeader() }} </thead>
    <tbody>
        {{ ui_elements.value_row('Request Acknowledge:', prefix+'_request_id') }}
        {{ ui_elements.value_row('Request Finished:', prefix+'_request_finished') }}
        {{ ui_elements.value_row('Error:', prefix+'_error') }}
        {{ ui_elements.value_row('Acquiring:', prefix+'_acquiring') }}
    </tbody>
</table>

<div class="clearfix"><div class="btn-group float-end">
{{ ui_elements.buttonSpinnerWithRequest("connect and configure", "max_caen.sendARequest", url, prefix, 'start_all', '{"open_connection":true, "write_registry":true, "acquire_data":true, "start_acquisition": true}') }}
{{ ui_elements.buttonSpinnerWithRequest("start acquisition", "max_caen.sendARequest", url, prefix, 'acquire_start', '{"start_acquisition":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("stop acquisition", "max_caen.sendARequest", url, prefix, 'acquire_stop', '{"stop_acquisition":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("store registers", "max_caen.sendARequest", url, prefix, 'store_reg', '{"store_registers":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("open connection", "max_caen.sendARequest", url, prefix, 'open', '{"open_connection":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("reset", "max_caen.sendARequest", url, prefix, 'reset', '{"reset":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("clear", "max_caen.sendARequest", url, prefix, 'clear', '{"clear":true}') }}
{{ ui_elements.buttonSpinnerWithRequest("continue", "max_caen.sendARequest", url, prefix, 'continue', '{"continue":true}') }}
    </div></div>
  </div>
</div>

      <div id="histo_chart">
      </div>
<script type="module">
    import * as max_caen from '{{url_for('static', filename='max_caen.js')}}'
    window.max_caen = max_caen;
    max_caen.refreshData('{{url}}','{{prefix}}');
    max_caen.drawGraph();
    window.setInterval(function() {
        max_caen.refreshData('{{url}}','{{prefix}}');
    }, 2000);
</script>
{% endblock %}
